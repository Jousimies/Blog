<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-04-19 Wed 14:04 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Listen music with emms in Emacs</title>
<meta name="author" content="Jousimie" />
<meta name="description" content="Emacs 听音乐" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="../css/style.css" />
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="/"> HOME </a>
</div><div id="preamble" class="status">
<a href="/index.html" class="button">Home</a>
               <a href="/posts/index.html" class="button">Posts</a>
               <a href="/about.html" class="button">About</a>
               <hr>
</div>
<div id="content" class="content">
<h1 class="title">Listen music with emms in Emacs</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org0ee5e04">1. 使用基本流程如下：</a></li>
</ul>
</div>
</div>
<p>
Emacs 再一次展现了其强大的功能，播放音乐不在话下。
</p>

<p>
有一个网易云音乐的插件可以使用，但是作者估计是不使用了，有很长时间没有更新。网易云音乐本身的 API 有所变更，导致该插件不可以使用，很是遗汗。
</p>

<p>
只好另找方法管理音乐。当前我使用 Telegram 中的 bot 查找音乐，然后使用 Emms 听音乐。
</p>

<p>
Emms 的配置如下，使用了三个插件，emms lyrics-fetcher 和 consult-emms.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #000000;">(</span><span style="color: #531ab6; font-weight: bold;">use-package</span> <span style="color: #0000b0;">emms</span>
  <span style="color: #8f0075; font-weight: bold;">:bind</span> <span style="color: #dd22dd;">(</span><span style="color: #008899;">(</span><span style="color: #3548cf;">"&lt;f5&gt;"</span> . emms<span style="color: #008899;">)</span>
         <span style="color: #008899;">(</span><span style="color: #3548cf;">"C-&lt;f5&gt;"</span> . my/toggle-emms<span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span>
  <span style="color: #8f0075; font-weight: bold;">:config</span>
  <span style="color: #dd22dd;">(</span><span style="color: #531ab6; font-weight: bold;">setq</span> emms-directory <span style="color: #008899;">(</span>expand-file-name <span style="color: #3548cf;">"cache/emms"</span> user-emacs-directory<span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span>
  <span style="color: #dd22dd;">(</span><span style="color: #531ab6; font-weight: bold;">setq</span> emms-player-list '<span style="color: #008899;">(</span>emms-player-mpv<span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span>
  <span style="color: #dd22dd;">(</span><span style="color: #531ab6; font-weight: bold;">setq</span> emms-browser-covers #'emms-browser-cache-thumbnail-async<span style="color: #dd22dd;">)</span>
  <span style="color: #dd22dd;">(</span><span style="color: #531ab6; font-weight: bold;">setq</span> emms-playlist-buffer-name <span style="color: #3548cf;">"*Music*"</span><span style="color: #dd22dd;">)</span>
  <span style="color: #dd22dd;">(</span>add-to-list 'display-buffer-alist '<span style="color: #008899;">(</span><span style="color: #972500;">(</span><span style="color: #531ab6; font-weight: bold;">or</span> <span style="color: #808000;">(</span>derived-mode . emms-playlist-mode<span style="color: #808000;">)</span>
                                           <span style="color: #808000;">(</span>derived-mode . emms-browser-mode<span style="color: #808000;">)</span><span style="color: #972500;">)</span>
                                       <span style="color: #972500;">(</span>display-buffer-in-tab<span style="color: #972500;">)</span>
                                       <span style="color: #972500;">(</span>tab-name <span style="color: #3548cf;">"Media"</span><span style="color: #972500;">)</span> <span style="color: #972500;">(</span>tab-group <span style="color: #3548cf;">"Media"</span><span style="color: #972500;">)</span><span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span>

  <span style="color: #dd22dd;">(</span><span style="color: #531ab6; font-weight: bold;">defun</span> <span style="color: #721045;">my/toggle-emms</span> <span style="color: #008899;">(</span>arg<span style="color: #008899;">)</span>
    <span style="color: #2a5045; font-style: italic;">"Toggle Emms playback: start if stopped, stop if playing.</span>
<span style="color: #2a5045; font-style: italic;">With universal argument (C-u), pause playback instead of stopping."</span>
    <span style="color: #008899;">(</span><span style="color: #531ab6; font-weight: bold;">interactive</span> <span style="color: #3548cf;">"P"</span><span style="color: #008899;">)</span>
    <span style="color: #008899;">(</span><span style="color: #531ab6; font-weight: bold;">if</span> emms-player-playing-p
        <span style="color: #972500;">(</span><span style="color: #531ab6; font-weight: bold;">if</span> arg
            <span style="color: #808000;">(</span>emms-stop<span style="color: #808000;">)</span>
          <span style="color: #808000;">(</span>emms-pause<span style="color: #808000;">)</span><span style="color: #972500;">)</span>
      <span style="color: #972500;">(</span>emms-start<span style="color: #972500;">)</span><span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>

<span style="color: #000000;">(</span><span style="color: #531ab6; font-weight: bold;">use-package</span> <span style="color: #0000b0;">emms-playlist-mode</span>
  <span style="color: #8f0075; font-weight: bold;">:after</span> emms
  <span style="color: #8f0075; font-weight: bold;">:config</span>
  <span style="color: #dd22dd;">(</span><span style="color: #531ab6; font-weight: bold;">setq</span> emms-playlist-mode-center-when-go t<span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>

<span style="color: #000000;">(</span><span style="color: #531ab6; font-weight: bold;">use-package</span> <span style="color: #0000b0;">emms-source-file</span>
  <span style="color: #8f0075; font-weight: bold;">:after</span> emms
  <span style="color: #8f0075; font-weight: bold;">:config</span>
  <span style="color: #dd22dd;">(</span><span style="color: #531ab6; font-weight: bold;">setq</span> emms-source-playlist-default-format 'native<span style="color: #dd22dd;">)</span>
  <span style="color: #dd22dd;">(</span><span style="color: #531ab6; font-weight: bold;">setq</span> emms-source-playlist-ask-before-overwrite nil<span style="color: #dd22dd;">)</span>

  <span style="color: #dd22dd;">(</span><span style="color: #531ab6; font-weight: bold;">setq</span> emms-source-file-default-directory <span style="color: #008899;">(</span>expand-file-name <span style="color: #3548cf;">"~/Music/"</span><span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>

<span style="color: #000000;">(</span><span style="color: #531ab6; font-weight: bold;">use-package</span> <span style="color: #0000b0;">emms-history</span>
  <span style="color: #8f0075; font-weight: bold;">:hook</span> <span style="color: #dd22dd;">(</span><span style="color: #008899;">(</span>emms-browser-show-display . emms-history-load<span style="color: #008899;">)</span>
         <span style="color: #008899;">(</span>emms-browser-hide-display . emms-history-save<span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>

<span style="color: #000000;">(</span><span style="color: #531ab6; font-weight: bold;">use-package</span> <span style="color: #0000b0;">emms-setup</span>
  <span style="color: #8f0075; font-weight: bold;">:after</span> emms
  <span style="color: #8f0075; font-weight: bold;">:config</span>
  <span style="color: #dd22dd;">(</span>emms-all<span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>

<span style="color: #000000;">(</span><span style="color: #531ab6; font-weight: bold;">use-package</span> <span style="color: #0000b0;">emms-browser</span>
  <span style="color: #8f0075; font-weight: bold;">:after</span> emms
  <span style="color: #8f0075; font-weight: bold;">:config</span>
  <span style="color: #dd22dd;">(</span><span style="color: #531ab6; font-weight: bold;">setq</span> emms-browser-thumbnail-small-size 64<span style="color: #dd22dd;">)</span>
  <span style="color: #dd22dd;">(</span><span style="color: #531ab6; font-weight: bold;">setq</span> emms-browser-thumbnail-medium-size 128<span style="color: #dd22dd;">)</span>

  <span style="color: #dd22dd;">(</span><span style="color: #531ab6; font-weight: bold;">evil-define-key</span> 'normal emms-browser-mode-map
    <span style="color: #3548cf;">"gb"</span> nil<span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>

<span style="color: #000000;">(</span><span style="color: #531ab6; font-weight: bold;">use-package</span> <span style="color: #0000b0;">emms-lyrics</span>
  <span style="color: #8f0075; font-weight: bold;">:hook</span> <span style="color: #dd22dd;">(</span>emms-player-started-hook . emms-lyrics-toggle-display-on-modeline<span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #000000;">(</span><span style="color: #531ab6; font-weight: bold;">use-package</span> <span style="color: #0000b0;">lyrics-fetcher</span>
  <span style="color: #8f0075; font-weight: bold;">:after</span> <span style="color: #dd22dd;">(</span>emms<span style="color: #dd22dd;">)</span>
  <span style="color: #8f0075; font-weight: bold;">:config</span>
  <span style="color: #dd22dd;">(</span><span style="color: #531ab6; font-weight: bold;">setq</span> lyrics-fetcher-genius-access-token
        <span style="color: #008899;">(</span>auth-source-pick-first-password <span style="color: #8f0075; font-weight: bold;">:host</span> <span style="color: #3548cf;">"genius.com"</span> <span style="color: #8f0075; font-weight: bold;">:user</span> <span style="color: #3548cf;">"ID"</span><span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span>
  <span style="color: #dd22dd;">(</span>lyrics-fetcher-use-backend 'neteasecloud<span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #000000;">(</span><span style="color: #531ab6; font-weight: bold;">use-package</span> <span style="color: #0000b0;">consult-emms</span>
  <span style="color: #8f0075; font-weight: bold;">:bind</span> <span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"M-&lt;f5&gt;"</span> . consult-emms-library<span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>
</pre>
</div>

<div id="outline-container-org0ee5e04" class="outline-2">
<h2 id="org0ee5e04"><span class="section-number-2">1.</span> 使用基本流程如下：</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li><code>f5</code> 调用 <code>emms</code> ，回车即可。
会默认打开 "<b>Music</b>" 这个 buffer。</li>
<li>移动光标到欲播放的音乐上按 <code>RET</code> ，开始播放音乐。</li>
<li><b>Music</b> buffer 是一个播放列表，可以通过 <code>M-f5</code> 增加歌曲到该列表中。</li>
<li>在 <b>Music</b> 中可以使用 <code>C-x C-s</code> 保存播放列表到指定的文件当中。
再次启动时可默认加载该文件。</li>
<li><code>C-f5</code> 开始播放或暂停音乐， <code>C-u C-f5</code> 可停止播放音乐。</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr><div class="info"> <span class="created">Created with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 30.0.50 (<a href="https://orgmode.org">Org</a> mode 9.6.3) on MacOS</span>
 <span class="updated">Updated: 2023-04-19 Wed 10:38</span> </div>
</div>
</body>
</html>